<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF & Word Merger with Page Numbering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/docx@7.8.1/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        .drop-zone {
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        .file-item {
            transition: all 0.3s ease;
        }
        .file-item:hover {
            background-color: #f7fafc;
        }
        .progress-bar {
            height: 6px;
            background-color: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background-color: #4299e1;
            transition: width 0.3s ease;
        }
        .file-icon-pdf {
            color: #e53e3e;
        }
        .file-icon-word {
            color: #2b579a;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">PDF & Word Merger with Page Numbering</h1>
            <p class="text-gray-600 max-w-2xl mx-auto">
                Upload PDF and Word documents, convert Word to PDF automatically, merge them, and add page numbers without altering the original files.
            </p>
        </header>

        <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
            <!-- File Upload Section -->
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Upload Files</h2>
                
                <div class="drop-zone p-8 text-center cursor-pointer mb-4" id="dropZone">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="mt-2 text-gray-600">Drag and drop your PDF and Word files here, or <span class="text-blue-500">browse</span></p>
                    <p class="text-sm text-gray-500 mt-1">Maximum 10 files, 10MB each</p>
                </div>
                
                <input type="file" id="fileInput" class="hidden" accept=".pdf,.doc,.docx" multiple>
                
                <div class="flex justify-between items-center">
                    <div>
                        <button id="addFilesBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-200">
                            Add Files
                        </button>
                        <button id="clearFilesBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg ml-2 transition duration-200">
                            Clear All
                        </button>
                    </div>
                    <span id="fileCount" class="text-gray-500">0 files selected</span>
                </div>
            </div>
            
            <!-- File List Section -->
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Selected Files</h2>
                <div id="fileList" class="space-y-3 max-h-60 overflow-y-auto">
                    <p class="text-gray-500 text-center py-4" id="emptyState">No files selected</p>
                </div>
            </div>
            
            <!-- Options Section -->
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Options</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Page Numbering</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="numbering" value="none" class="mr-2" checked>
                                <span>No page numbers</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="numbering" value="bottom-center" class="mr-2">
                                <span>Bottom center</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="numbering" value="bottom-right" class="mr-2">
                                <span>Bottom right</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="numbering" value="top-right" class="mr-2">
                                <span>Top right</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Other Options</h3>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="preserveBookmarks" class="mr-2" checked>
                                <span>Preserve bookmarks</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="preserveForms" class="mr-2" checked>
                                <span>Preserve form fields</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="autoConvertWord" class="mr-2" checked>
                                <span>Auto-convert Word to PDF</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Progress Section -->
            <div class="p-6 border-b border-gray-200 hidden" id="progressSection">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">Processing</h2>
                <div class="mb-2 flex justify-between">
                    <span id="progressText">Initializing...</span>
                    <span id="progressPercent">0%</span>
                </div>
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- Action Section -->
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-between items-center">
                    <div class="mb-4 sm:mb-0">
                        <p class="text-gray-600" id="statusText">Ready to process your files</p>
                    </div>
                    <button id="processBtn" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition duration-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
                        </svg>
                        Merge & Add Page Numbers
                    </button>
                </div>
            </div>
        </div>
        
        <div class="mt-8 text-center text-gray-500 text-sm">
            <p>Your files are processed locally in your browser - they are never uploaded to any server.</p>
        </div>
    </div>

    <script>
        // Global variables
        let selectedFiles = [];
        const maxFiles = 10;
        const maxFileSize = 10 * 1024 * 1024; // 10MB in bytes

        // DOM elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const addFilesBtn = document.getElementById('addFilesBtn');
        const clearFilesBtn = document.getElementById('clearFilesBtn');
        const fileList = document.getElementById('fileList');
        const fileCount = document.getElementById('fileCount');
        const emptyState = document.getElementById('emptyState');
        const processBtn = document.getElementById('processBtn');
        const progressSection = document.getElementById('progressSection');
        const progressText = document.getElementById('progressText');
        const progressPercent = document.getElementById('progressPercent');
        const progressFill = document.getElementById('progressFill');
        const statusText = document.getElementById('statusText');

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            addFilesBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            clearFilesBtn.addEventListener('click', clearAllFiles);
            processBtn.addEventListener('click', processFiles);
            
            // Drag and drop events
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFiles(e.dataTransfer.files);
                }
            });
        });

        // Handle file selection from input
        function handleFileSelect(e) {
            handleFiles(e.target.files);
            fileInput.value = ''; // Reset input to allow selecting same files again
        }

        // Process selected files
        function handleFiles(files) {
            if (selectedFiles.length + files.length > maxFiles) {
                alert(`You can only select up to ${maxFiles} files.`);
                return;
            }
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Check if file is PDF or Word
                if (!isValidFileType(file)) {
                    alert(`${file.name} is not a PDF or Word file. Please select PDF or Word files only.`);
                    continue;
                }
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert(`${file.name} is too large. Maximum file size is 10MB.`);
                    continue;
                }
                
                // Add file to list if not already added
                if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    selectedFiles.push(file);
                }
            }
            
            updateFileList();
        }

        // Check if file is PDF or Word
        function isValidFileType(file) {
            const validTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ];
            return validTypes.includes(file.type) || 
                   file.name.endsWith('.pdf') || 
                   file.name.endsWith('.doc') || 
                   file.name.endsWith('.docx');
        }

        // Get file type for display
        function getFileType(file) {
            if (file.type === 'application/pdf' || file.name.endsWith('.pdf')) {
                return 'pdf';
            } else if (file.type === 'application/msword' || file.name.endsWith('.doc') || 
                      file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' || 
                      file.name.endsWith('.docx')) {
                return 'word';
            }
            return 'unknown';
        }

        // Update the file list UI
        function updateFileList() {
            // Clear the list
            fileList.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                fileList.appendChild(emptyState);
                emptyState.classList.remove('hidden');
                fileCount.textContent = '0 files selected';
                processBtn.disabled = true;
                return;
            }
            
            emptyState.classList.add('hidden');
            fileCount.textContent = `${selectedFiles.length} file${selectedFiles.length > 1 ? 's' : ''} selected`;
            processBtn.disabled = false;
            
            // Add each file to the list
            selectedFiles.forEach((file, index) => {
                const fileType = getFileType(file);
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        ${fileType === 'pdf' ? 
                            `<svg class="h-6 w-6 file-icon-pdf mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>` :
                            `<svg class="h-6 w-6 file-icon-word mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>`
                        }
                        <div>
                            <p class="font-medium text-gray-700 truncate max-w-xs">${file.name}</p>
                            <p class="text-sm text-gray-500">${formatFileSize(file.size)} â€¢ ${fileType.toUpperCase()}</p>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <span class="text-xs font-medium mr-3 px-2.5 py-0.5 rounded ${fileType === 'pdf' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                            ${fileType === 'pdf' ? 'PDF' : 'WORD'}
                        </span>
                        <button class="text-red-500 hover:text-red-700 transition duration-200 remove-file" data-index="${index}">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-file').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    removeFile(index);
                });
            });
        }

        // Remove a file from the list
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }

        // Clear all files
        function clearAllFiles() {
            selectedFiles = [];
            updateFileList();
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Process the files
        async function processFiles() {
            if (selectedFiles.length === 0) {
                alert('Please select at least one file.');
                return;
            }
            
            // Show progress section
            progressSection.classList.remove('hidden');
            processBtn.disabled = true;
            statusText.textContent = 'Processing your files...';
            
            try {
                // Initialize PDFLib
                const { PDFDocument, rgb } = PDFLib;
                
                // Create a new PDF document
                const mergedPdf = await PDFDocument.create();
                
                // Get numbering option
                const numberingOption = document.querySelector('input[name="numbering"]:checked').value;
                
                let totalPages = 0;
                let currentPage = 0;
                
                // First, count total pages for progress tracking
                for (const file of selectedFiles) {
                    const fileType = getFileType(file);
                    
                    if (fileType === 'pdf') {
                        const fileBytes = await readFileAsArrayBuffer(file);
                        const pdfDoc = await PDFDocument.load(fileBytes);
                        totalPages += pdfDoc.getPageCount();
                    } else if (fileType === 'word') {
                        // For Word documents, we'll estimate 1 page per 500 words
                        // This is a rough estimate and will be updated during actual conversion
                        const text = await readFileAsText(file);
                        const wordCount = text.split(/\s+/).length;
                        totalPages += Math.max(1, Math.ceil(wordCount / 500));
                    }
                }
                
                // Process each file
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    const fileType = getFileType(file);
                    
                    progressText.textContent = `Processing ${file.name}...`;
                    
                    if (fileType === 'pdf') {
                        const fileBytes = await readFileAsArrayBuffer(file);
                        const pdfDoc = await PDFDocument.load(fileBytes);
                        
                        // Copy pages from the current PDF
                        const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                        
                        // Add each page to the merged PDF
                        for (let j = 0; j < pages.length; j++) {
                            const page = pages[j];
                            currentPage++;
                            
                            // Add page number if requested
                            if (numberingOption !== 'none') {
                                addPageNumber(page, currentPage, totalPages, numberingOption);
                            }
                            
                            mergedPdf.addPage(page);
                            
                            // Update progress
                            const progress = Math.round((currentPage / totalPages) * 100);
                            progressPercent.textContent = `${progress}%`;
                            progressFill.style.width = `${progress}%`;
                        }
                    } else if (fileType === 'word') {
                        // Convert Word to PDF
                        progressText.textContent = `Converting ${file.name} to PDF...`;
                        
                        const pdfBytes = await convertWordToPdf(file);
                        const pdfDoc = await PDFDocument.load(pdfBytes);
                        
                        // Copy pages from the converted PDF
                        const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                        
                        // Add each page to the merged PDF
                        for (let j = 0; j < pages.length; j++) {
                            const page = pages[j];
                            currentPage++;
                            
                            // Add page number if requested
                            if (numberingOption !== 'none') {
                                addPageNumber(page, currentPage, totalPages, numberingOption);
                            }
                            
                            mergedPdf.addPage(page);
                            
                            // Update progress
                            const progress = Math.round((currentPage / totalPages) * 100);
                            progressPercent.textContent = `${progress}%`;
                            progressFill.style.width = `${progress}%`;
                        }
                    }
                }
                
                // Save the merged PDF
                const mergedPdfBytes = await mergedPdf.save();
                
                // Create download link
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'merged-document.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Reset UI
                progressText.textContent = 'Processing complete!';
                statusText.textContent = 'Your merged PDF has been downloaded.';
                setTimeout(() => {
                    progressSection.classList.add('hidden');
                    processBtn.disabled = false;
                    statusText.textContent = 'Ready to process your files';
                    progressFill.style.width = '0%';
                    progressPercent.textContent = '0%';
                }, 2000);
                
            } catch (error) {
                console.error('Error processing files:', error);
                alert('An error occurred while processing the files. Please try again.');
                progressSection.classList.add('hidden');
                processBtn.disabled = false;
                statusText.textContent = 'Error processing files. Please try again.';
            }
        }

        // Read file as ArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        // Read file as text
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        // Convert Word document to PDF
        async function convertWordToPdf(file) {
            return new Promise(async (resolve, reject) => {
                try {
                    const arrayBuffer = await readFileAsArrayBuffer(file);
                    
                    // Use Mammoth to convert DOCX to HTML
                    const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                    const html = result.value;
                    
                    // Create a simple PDF from the HTML content
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    // Split the HTML into lines that fit the PDF
                    const lines = html.split('\n');
                    let y = 20;
                    const lineHeight = 7;
                    const pageHeight = doc.internal.pageSize.height;
                    
                    for (let i = 0; i < lines.length; i++) {
                        // Simple text extraction (remove HTML tags)
                        const text = lines[i].replace(/<[^>]*>/g, '').trim();
                        
                        if (text) {
                            // Check if we need a new page
                            if (y > pageHeight - 20) {
                                doc.addPage();
                                y = 20;
                            }
                            
                            doc.text(text, 20, y);
                            y += lineHeight;
                        }
                    }
                    
                    // Get the PDF as ArrayBuffer
                    const pdfOutput = doc.output('arraybuffer');
                    resolve(pdfOutput);
                } catch (error) {
                    console.error('Error converting Word to PDF:', error);
                    reject(error);
                }
            });
        }

        // Add page number to a PDF page
        function addPageNumber(page, currentPage, totalPages, position) {
            const { width, height } = page.getSize();
            
            let x, y;
            
            switch (position) {
                case 'bottom-center':
                    x = width / 2;
                    y = 30;
                    break;
                case 'bottom-right':
                    x = width - 50;
                    y = 30;
                    break;
                case 'top-right':
                    x = width - 50;
                    y = height - 30;
                    break;
                default:
                    return; // No numbering
            }
            
            page.drawText(`${currentPage}`, {
                x: x,
                y: y,
                size: 12,
                color: PDFLib.rgb(0, 0, 0),
            });
        }
    </script>
</body>
</html>
